<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slot Machine</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: system-ui, sans-serif;
  }

  body {
    background: radial-gradient(circle at top, #0b1924, #02070b 70%);
    color: #f4f4f4;
    display: flex;
    justify-content: center;
    padding: 30px;
    min-height: 100vh;
  }

  .wrapper {
    width: 100%;
    max-width: 700px;
    background: #0f2a38;
    padding: 25px;
    border-radius: 16px;
    border: 3px solid rgba(255,255,255,0.1);
    box-shadow: 0 10px 25px rgba(0,0,0,0.6);
  }

  h1 {
    text-align: center;
    font-size: 38px;
    letter-spacing: 4px;
    margin-bottom: 20px;
  }

  .bankroll {
    text-align: center;
    font-size: 20px;
    margin-bottom: 15px;
  }

  .bankroll span {
    color: #ffe887;
    font-weight: 700;
  }

  .slot-frame {
    background: radial-gradient(circle at center, #14542b 0, #064020 55%, #02200b 100%);
    border: 6px solid #c4a15a;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.75);
  }

  .reels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .reel {
    width: 30%;
    height: 140px;
    background: #ffffff;
    border-radius: 12px;
    border: 3px solid #c4a15a;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 60px;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.4);
    overflow: hidden;
    position: relative;
  }

  .symbol {
    position: absolute;
    font-size: 60px;
    transition: transform 0.15s ease-out;
  }

  .controls {
    text-align: center;
    margin-top: 15px;
  }

  .btn {
    padding: 10px 20px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    margin: 5px;
    background: radial-gradient(circle at top, #f9d675, #d8a73e);
    color: #111;
    box-shadow: 0 4px 0 #8a6220;
    transition: 0.1s;
  }

  .btn:hover {
    filter: brightness(1.05);
  }

  .btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #8a6220;
  }

  .message {
    text-align: center;
    margin-top: 15px;
    font-size: 20px;
    min-height: 24px;
  }

  .message.win {
    color: #ffe887;
    font-weight: 700;
  }

  .message.lose {
    color: #ff9b9b;
  }

  .bet-select {
    text-align: center;
    margin-bottom: 15px;
  }

  .bet-select select {
    padding: 6px 10px;
    border-radius: 8px;
    border: 2px solid #c4a15a;
    background: rgba(0,0,0,0.4);
    color: #ffe887;
    font-weight: 600;
  }
</style>
</head>
<body>

<div class="wrapper">
  <h1>Slot Machine</h1>

  <div class="bankroll">
    Bankroll: <span id="bankroll">$1000</span>
  </div>

  <div class="bet-select">
    <label>Bet: </label>
    <select id="bet">
      <option value="10">$10</option>
      <option value="20">$20</option>
      <option value="50">$50</option>
      <option value="100">$100</option>
    </select>
  </div>

  <div class="slot-frame">
    <div class="reels">
      <div class="reel" id="reel1"></div>
      <div class="reel" id="reel2"></div>
      <div class="reel" id="reel3"></div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="spinBtn">SPIN</button>
  </div>

  <div class="message" id="message"></div>
</div>

<script>
const symbols = ["ðŸ’", "ðŸ‹", "ðŸ‡", "â­", "7", "BAR"];

const reel1 = document.getElementById("reel1");
const reel2 = document.getElementById("reel2");
const reel3 = document.getElementById("reel3");

const bankrollSpan = document.getElementById("bankroll");
const betSelect = document.getElementById("bet");
const messageDiv = document.getElementById("message");
const spinBtn = document.getElementById("spinBtn");

let bankroll = 1000;
let spinning = false;

function updateBankroll() {
  bankrollSpan.textContent = "$" + bankroll;
}

function randomSymbol() {
  return symbols[Math.floor(Math.random() * symbols.length)];
}

function createSymbolElement(sym) {
  const el = document.createElement("div");
  el.className = "symbol";
  el.textContent = sym;
  return el;
}

// âœ… FIXED: reels now only show ONE symbol at a time
function spinReel(reel, duration) {
  return new Promise(resolve => {
    let start = performance.now();

    function animate(now) {
      const elapsed = now - start;

      // Clear reel each frame
      reel.innerHTML = "";

      // Add new symbol
      const sym = createSymbolElement(randomSymbol());
      sym.style.transform = "translateY(-100%)";
      reel.appendChild(sym);

      requestAnimationFrame(() => {
        sym.style.transform = "translateY(0%)";
      });

      if (elapsed < duration) {
        requestAnimationFrame(animate);
      } else {
        resolve();
      }
    }

    animate(start);
  });
}

function getFinalSymbols() {
  return [
    reel1.children[0].textContent,
    reel2.children[0].textContent,
    reel3.children[0].textContent
  ];
}

function calculatePayout(result, bet) {
  const [a, b, c] = result;

  if (a === b && b === c) {
    switch (a) {
      case "BAR": return bet * 50;
      case "7": return bet * 25;
      case "â­": return bet * 10;
      case "ðŸ‡": return bet * 5;
      case "ðŸ‹": return bet * 3;
      case "ðŸ’": return bet * 2;
    }
  }

  if (a === b || b === c || a === c) {
    return bet * 1;
  }

  return 0;
}

async function spin() {
  if (spinning) return;
  spinning = true;

  messageDiv.textContent = "";
  messageDiv.className = "message";

  const bet = parseInt(betSelect.value);

  if (bankroll < bet) {
    messageDiv.textContent = "Not enough funds!";
    messageDiv.classList.add("lose");
    spinning = false;
    return;
  }

  bankroll -= bet;
  updateBankroll();

  await Promise.all([
    spinReel(reel1, 1200),
    spinReel(reel2, 1500),
    spinReel(reel3, 1800)
  ]);

  const result = getFinalSymbols();
  const payout = calculatePayout(result, bet);

  if (payout > 0) {
    bankroll += payout;
    updateBankroll();
    messageDiv.textContent = "You won $" + payout + "!";
    messageDiv.classList.add("win");
  } else {
    messageDiv.textContent = "No win. Try again!";
    messageDiv.classList.add("lose");
  }

  spinning = false;
}

spinBtn.addEventListener("click", spin);

// Initialize reels
[reel1, reel2, reel3].forEach(reel => {
  const sym = createSymbolElement(randomSymbol());
  reel.appendChild(sym);
});

updateBankroll();
</script>

</body>
</html>
