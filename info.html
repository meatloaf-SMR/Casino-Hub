<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Casino Hub – Global Stats</title>

<style>
  body {
    background: #0b1924;
    color: white;
    font-family: system-ui, sans-serif;
    text-align: center;
    padding: 40px;
  }

  h1 {
    font-size: 42px;
    margin-bottom: 20px;
    letter-spacing: 3px;
  }

  #statsBox {
    background: #102733;
    padding: 25px;
    border-radius: 14px;
    max-width: 700px;
    margin: 0 auto;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    font-size: 20px;
  }

  .sectionTitle {
    font-size: 26px;
    margin-top: 25px;
    margin-bottom: 10px;
    text-decoration: underline;
  }

  button {
    margin-top: 35px;
    padding: 12px 25px;
    font-size: 20px;
    background: #f9d675;
    color: #111;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 0 #8a6220;
  }

  button:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #8a6220;
  }
</style>
</head>
<body>

<h1>Casino Hub – Global Stats</h1>

<div id="statsBox">
  Loading global stats...
</div>

<button onclick="resetStats()">Admin Reset</button>

<!-- ✅ Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD9OM6J2tTo5Hj2WCT13ztUPpP61s2XZ9c",
    authDomain: "casinohub-9c9e1.firebaseapp.com",
    projectId: "casinohub-9c9e1",
    storageBucket: "casinohub-9c9e1.appspot.com",
    messagingSenderId: "811062003530",
    appId: "1:811062003530:web:5a93c6e17e7b27c1ad6b3b",
    measurementId: "G-M63NEGYSYQ"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function getTodayString() {
    return new Date().toISOString().split("T")[0];
  }

  async function loadStats() {
    const today = getTodayString();
    const statsBox = document.getElementById("statsBox");

    try {
      // ✅ 1. Global site opens
      const metaSnap = await db.collection("meta").doc("daily").get();
      const siteOpens = metaSnap.exists ? metaSnap.data().siteOpenCount : 0;

      // ✅ 2. Global user list
      const usersSnap = await db.collection("users").get();
      const userList = [];
      usersSnap.forEach(doc => {
        const d = doc.data();
        userList.push(`${d.name} (visits: ${d.totalVisits || 0})`);
      });

      // ✅ 3. Daily activity (Top 3)
      const dailySnap = await db.collection("dailyActivity").doc(today).get();
      let activity = dailySnap.exists ? dailySnap.data() : {};

      const topUsers = Object.entries(activity)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);

      // ✅ Render everything
      statsBox.innerHTML = `
        <div class="sectionTitle">Global Site Opens Today</div>
        <div>${siteOpens}</div>

        <div class="sectionTitle">Global Users (All Time)</div>
        <div>${userList.length}</div>

        <div style="margin-top:10px; font-size:18px;">
          ${userList.join("<br>")}
        </div>

        <div class="sectionTitle">Top 3 Users Today</div>
        <div>
          ${
            topUsers.length === 0
              ? "No activity yet today."
              : topUsers.map(([name, count]) => `${name} (${count})`).join("<br>")
          }
        </div>
      `;
    } catch (err) {
      statsBox.innerHTML = "Error loading stats.";
      console.error(err);
    }
  }

  async function resetStats() {
    if (!confirm("Reset ALL global stats?")) return;

    try {
      // ✅ Clear meta
      await db.collection("meta").doc("daily").delete();

      // ✅ Clear users
      const users = await db.collection("users").get();
      users.forEach(doc => doc.ref.delete());

      // ✅ Clear daily activity
      const daily = await db.collection("dailyActivity").get();
      daily.forEach(doc => doc.ref.delete());

      alert("Global stats reset.");
      loadStats();
    } catch (err) {
      alert("Error resetting stats.");
      console.error(err);
    }
  }

  loadStats();
</script>

</body>
</html>
