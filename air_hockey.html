<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Air Hockey</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  body {
    background: radial-gradient(circle at top, #0b1924 0, #02070b 60%, #000 100%);
    color: #f4f4f4;
    display: flex;
    justify-content: center;
    padding: 30px;
    min-height: 100vh;
  }

  .wrapper {
    width: 100%;
    max-width: 1100px;
  }

  h1 {
    text-align: center;
    font-size: 38px;
    letter-spacing: 4px;
    margin-bottom: 20px;
  }

  .mode-select {
    text-align: center;
    margin-bottom: 20px;
  }

  .btn {
    padding: 10px 20px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    margin: 5px;
    background: radial-gradient(circle at top, #f9d675, #d8a73e);
    color: #111;
    box-shadow: 0 4px 0 #8a6220;
    transition: 0.1s;
  }

  .btn:hover {
    filter: brightness(1.05);
  }

  .btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #8a6220;
  }

  .scoreboard {
    text-align: center;
    font-size: 22px;
    margin-bottom: 15px;
    letter-spacing: 2px;
  }

  .table {
    position: relative;
    width: 100%;
    height: 600px;
    background: radial-gradient(circle at center, #0f5b24 0, #064018 55%, #02200b 100%);
    border-radius: 20px;
    border: 6px solid #c4a15a;
    box-shadow: 0 20px 50px rgba(0,0,0,0.75);
    overflow: hidden;
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .reset-area {
    text-align: center;
    margin-top: 15px;
  }
</style>
</head>
<body>

<div class="wrapper">
  <h1>Air Hockey</h1>

  <div class="mode-select">
    <button class="btn" id="mode1p">1 Player (vs AI)</button>
    <button class="btn" id="mode2p">2 Player</button>
  </div>

  <div class="scoreboard">
    <span id="scoreP1">0</span> - <span id="scoreP2">0</span>
  </div>

  <div class="table">
    <canvas id="airCanvas" width="1000" height="600"></canvas>
  </div>

  <div class="reset-area">
    <button class="btn" id="resetBtn">Reset Game</button>
  </div>
</div>
<script>
const canvas = document.getElementById("airCanvas");
const ctx = canvas.getContext("2d");

let mode = "1p"; // "1p" or "2p"
let scoreP1 = 0;
let scoreP2 = 0;

const scoreP1Span = document.getElementById("scoreP1");
const scoreP2Span = document.getElementById("scoreP2");

document.getElementById("mode1p").onclick = () => { mode = "1p"; resetGame(); };
document.getElementById("mode2p").onclick = () => { mode = "2p"; resetGame(); };
document.getElementById("resetBtn").onclick = resetGame;

const table = {
  width: canvas.width,
  height: canvas.height,
  goalWidth: 260
};

const puck = {
  x: table.width / 2,
  y: table.height / 2,
  radius: 14,
  vx: 0,
  vy: 0,
  friction: 0.992
};

const p1 = {
  x: table.width / 2,
  y: table.height - 80,
  radius: 35,
  speed: 8
};

const p2 = {
  x: table.width / 2,
  y: 80,
  radius: 35,
  speed: 6
};

let mouseX = p1.x;
let mouseY = p1.y;

let keys = {};

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
});

function resetPositions() {
  puck.x = table.width / 2;
  puck.y = table.height / 2;
  puck.vx = 0;
  puck.vy = 0;

  p1.x = table.width / 2;
  p1.y = table.height - 80;

  p2.x = table.width / 2;
  p2.y = 80;
}

function resetGame() {
  scoreP1 = 0;
  scoreP2 = 0;
  updateScore();
  resetPositions();
}

function updateScore() {
  scoreP1Span.textContent = scoreP1;
  scoreP2Span.textContent = scoreP2;
}

function movePlayers() {
  // Player 1 (mouse)
  p1.x += (mouseX - p1.x) * 0.25;
  p1.y += (mouseY - p1.y) * 0.25;

  // Keep P1 on bottom half
  if (p1.y < table.height / 2 + p1.radius) p1.y = table.height / 2 + p1.radius;

  // Player 2 (AI or human)
  if (mode === "1p") {
    // AI follows puck with easing
    p2.x += (puck.x - p2.x) * 0.05;
    p2.y += (puck.y - p2.y) * 0.05;

    // Keep P2 on top half
    if (p2.y > table.height / 2 - p2.radius) p2.y = table.height / 2 - p2.radius;
  } else {
    // 2-Player mode
    if (keys["arrowup"] || keys["w"]) p2.y -= p2.speed;
    if (keys["arrowdown"] || keys["s"]) p2.y += p2.speed;
    if (keys["arrowleft"] || keys["a"]) p2.x -= p2.speed;
    if (keys["arrowright"] || keys["d"]) p2.x += p2.speed;

    // Keep P2 on top half
    if (p2.y > table.height / 2 - p2.radius) p2.y = table.height / 2 - p2.radius;
  }

  // Keep paddles inside table
  [p1, p2].forEach(p => {
    if (p.x < p.radius) p.x = p.radius;
    if (p.x > table.width - p.radius) p.x = table.width - p.radius;
    if (p.y < p.radius) p.y = p.radius;
    if (p.y > table.height - p.radius) p.y = table.height - p.radius;
  });
}

function movePuck() {
  puck.x += puck.vx;
  puck.y += puck.vy;

  puck.vx *= puck.friction;
  puck.vy *= puck.friction;

  // Wall collisions
  if (puck.x < puck.radius) {
    puck.x = puck.radius;
    puck.vx *= -1;
  }
  if (puck.x > table.width - puck.radius) {
    puck.x = table.width - puck.radius;
    puck.vx *= -1;
  }

  // Top goal
  if (puck.y < puck.radius) {
    if (puck.x > table.width/2 - table.goalWidth/2 &&
        puck.x < table.width/2 + table.goalWidth/2) {
      scoreP1++;
      updateScore();
      resetPositions();
      return;
    }
    puck.y = puck.radius;
    puck.vy *= -1;
  }

  // Bottom goal
  if (puck.y > table.height - puck.radius) {
    if (puck.x > table.width/2 - table.goalWidth/2 &&
        puck.x < table.width/2 + table.goalWidth/2) {
      scoreP2++;
      updateScore();
      resetPositions();
      return;
    }
    puck.y = table.height - puck.radius;
    puck.vy *= -1;
  }

  // Paddle collisions
  [p1, p2].forEach(p => {
    const dx = puck.x - p.x;
    const dy = puck.y - p.y;
    const dist = Math.hypot(dx, dy);
    const minDist = puck.radius + p.radius;

    if (dist < minDist) {
      const angle = Math.atan2(dy, dx);
      const overlap = minDist - dist;

      puck.x += Math.cos(angle) * overlap;
      puck.y += Math.sin(angle) * overlap;

      puck.vx = Math.cos(angle) * 12;
      puck.vy = Math.sin(angle) * 12;
    }
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Mid line
  ctx.strokeStyle = "rgba(255,255,255,0.2)";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(0, table.height/2);
  ctx.lineTo(table.width, table.height/2);
  ctx.stroke();

  // Goals
  ctx.fillStyle = "rgba(255,255,255,0.15)";
  ctx.fillRect(
    table.width/2 - table.goalWidth/2,
    0,
    table.goalWidth,
    20
  );
  ctx.fillRect(
    table.width/2 - table.goalWidth/2,
    table.height - 20,
    table.goalWidth,
    20
  );

  // Puck
  ctx.fillStyle = "#ffffff";
  ctx.beginPath();
  ctx.arc(puck.x, puck.y, puck.radius, 0, Math.PI*2);
  ctx.fill();

  // Paddles
  ctx.fillStyle = "#ffe887";
  ctx.beginPath();
  ctx.arc(p1.x, p1.y, p1.radius, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#ff6b6b";
  ctx.beginPath();
  ctx.arc(p2.x, p2.y, p2.radius, 0, Math.PI*2);
  ctx.fill();
}

function gameLoop() {
  movePlayers();
  movePuck();
  draw();
  requestAnimationFrame(gameLoop);
}

resetGame();
gameLoop();
</script>
</body>
</html>
